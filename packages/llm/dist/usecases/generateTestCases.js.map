{"version":3,"file":"generateTestCases.js","sourceRoot":"","sources":["../../src/usecases/generateTestCases.ts"],"names":[],"mappings":"AAAA;;;;;;GAMG;AAGH,OAAO,EAAE,CAAC,EAAE,MAAM,KAAK,CAAC;AACxB,OAAO,EAAE,cAAc,EAAmC,MAAM,aAAa,CAAC;AAG9E,OAAO,EAAE,OAAO,EAAE,MAAM,2BAA2B,CAAC;AACpD,OAAO,EAAE,WAAW,EAAE,MAAM,yBAAyB,CAAC;AACtD,OAAO,EAAE,cAAc,EAAE,MAAM,4BAA4B,CAAC;AAE5D,MAAM,mBAAmB,GAAG,CAAC,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC;AAEpD,MAAM,CAAC,KAAK,UAAU,iBAAiB,CACrC,GAAe,EACf,IAAiB;IAEjB,MAAM,GAAG,GAAG,MAAM,GAAG,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;IAE9C,mEAAmE;IACnE,oDAAoD;IACpD,MAAM,MAAM,GACV,OAAO,GAAG,KAAK,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC;IAElD,MAAM,IAAI,GAAG,OAAO,CAAC,QAAQ,EAAE,CAAC;IAChC,MAAM,IAAI,GAAG,WAAW,CAAC,IAAI,CAAC,CAAC;IAC/B,MAAM,UAAU,GAAG,CAAC,GAAW,EAAE,GAAW,EAAE,EAAE,CAC9C,GAAG,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;IAG3D,OAAO,CAAC,GAAG,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;IAEnC,OAAO,CAAC,GAAG,CAAC,yBAAyB,CAAC,CAAC;IACvC,OAAO,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC;IACrC,OAAO,CAAC,GAAG,CAAC,aAAa,EAAE,CAAC,IAAI,CAAC,SAAS,GAAG,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC;IACpE,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC,IAAI,CAAC,YAAY,GAAG,GAAG,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC;IAC1E,OAAO,CAAC,GAAG,CAAC,wBAAwB,EAAE,UAAU,CAAC,IAAI,CAAC,iBAAiB,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC,CAAC;IACjG,OAAO,CAAC,GAAG,CAAC,2BAA2B,EAAE,IAAI,CAAC,qBAAqB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;IAEhF,MAAM,MAAM,GAAG,cAAc,CAAC,IAAI,CAAC,CAAC;IAEpC,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC;IAC3C,8BAA8B;IAC9B,yCAAyC;IACzC,+BAA+B;IAC/B,MAAM;IACN,WAAW;IACX,iDAAiD;IACjD,IAAI;IAEJ,OAAO,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC;IACtC,MAAM,MAAM,GAAG,CAAC,GAAG,IAAI,GAAG,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC;IAC5C,IAAI,MAAM,CAAC,MAAM,EAAE,CAAC;QAClB,KAAK,MAAM,CAAC,IAAI,MAAM;YAAE,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;IAC9C,CAAC;SAAM,CAAC;QACN,OAAO,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;IACrC,CAAC;IAED,OAAO,CAAC,GAAG,CAAC,uCAAuC,CAAC,CAAC;IAErD,OAAO,mBAAmB,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;AAC3C,CAAC","sourcesContent":["/**\n * Use case: FeatureSpec -> TestCase[]\n * 1) riceve input validato (FeatureSpec dal core)\n * 2) chiama l'LLMAdapter (mock o reale)\n * 3) valida l'output con schema (Zod) per renderlo \"safe\"\n * 4) ritorna TestCase[] pronto per tooling/QA/automation\n */\n\n\nimport { z } from \"zod\";\nimport { TestCaseSchema, type FeatureSpec, type TestCase } from \"@llmqa/core\";\nimport type { LLMAdapter } from \"../LLMAdapter.js\";\n\nimport { metrics } from \"../infra/metrics/index.js\";\nimport { computeKPIs } from \"../infra/metrics/kpi.js\";\nimport { evaluateHealth } from \"../infra/metrics/health.js\";\n\nconst TestCaseArraySchema = z.array(TestCaseSchema);\n\nexport async function generateTestCases(\n  llm: LLMAdapter,\n  spec: FeatureSpec\n): Promise<TestCase[]> {\n  const raw = await llm.generateTestCases(spec);\n\n  // Se il tuo adapter ritorna giÃ  oggetti -> validiamo direttamente.\n  // Se ritorna stringa JSON -> parse e poi validiamo.\n  const parsed =\n    typeof raw === \"string\" ? JSON.parse(raw) : raw;\n\n  const snap = metrics.snapshot();\n  const kpis = computeKPIs(snap);\n  const formatRate = (num: number, den: number) =>\n    den === 0 ? \"N/A\" : ((num / den) * 100).toFixed(1) + \"%\";\n\n\n  console.log(\"\\nðŸ“Š metrics:\", snap);\n\n  console.log(\"\\nðŸ“Š Reliability Report\");\n  console.log(\"---------------------\");\n  console.log(\"Retry rate:\", (kpis.retryRate * 100).toFixed(1) + \"%\");\n  console.log(\"Fallback rate:\", (kpis.fallbackRate * 100).toFixed(1) + \"%\");\n  console.log(\"Recovery success rate:\", formatRate(snap.recoverySuccesses, snap.recoveryAttempts));\n  console.log(\"Avg attempts per request:\", kpis.avgAttemptsPerRequest.toFixed(2));\n\n  const health = evaluateHealth(snap);\n\n  console.log(\"\\nðŸ©º Health:\", health.status);\n  // if (health.issues.length) {\n  //   for (const issue of health.issues) {\n  //     console.log(\"-\", issue);\n  //   }\n  // } else {\n  //   console.log(\"- all KPIs within thresholds\");\n  // }\n\n  console.log(\"\\nðŸ›  Suggested actions\");\n  const unique = [...new Set(health.actions)];\n  if (unique.length) {\n    for (const a of unique) console.log(\"-\", a);\n  } else {\n    console.log(\"- no actions needed\");\n  }\n\n  console.log(\"\\n\\n-----------------------------\\n\\n\");\n\n  return TestCaseArraySchema.parse(parsed);\n}\n"]}