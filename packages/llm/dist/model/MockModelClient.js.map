{"version":3,"file":"MockModelClient.js","sourceRoot":"","sources":["../../src/model/MockModelClient.ts"],"names":[],"mappings":"AAEA,SAAS,KAAK,CAAC,EAAU,EAAE,MAAoB;IAC7C,OAAO,IAAI,OAAO,CAAO,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;QAC3C,MAAM,EAAE,GAAG,UAAU,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;QAEnC,IAAI,CAAC,MAAM;YAAE,OAAO;QAEpB,IAAI,MAAM,CAAC,OAAO,EAAE,CAAC;YACnB,YAAY,CAAC,EAAE,CAAC,CAAC;YACjB,OAAO,MAAM,CAAC,MAAM,CAAC,MAAM,IAAI,IAAI,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC;QACvD,CAAC;QAED,MAAM,CAAC,gBAAgB,CACrB,OAAO,EACP,GAAG,EAAE;YACH,YAAY,CAAC,EAAE,CAAC,CAAC;YACjB,MAAM,CAAC,MAAM,CAAC,MAAM,IAAI,IAAI,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC;QAChD,CAAC,EACD,EAAE,IAAI,EAAE,IAAI,EAAE,CACf,CAAC;IACJ,CAAC,CAAC,CAAC;AACL,CAAC;AAED,IAAI,KAAK,GAAG,CAAC,CAAC;AAEd;;;;;GAKG;AACH,MAAM,UAAU,GAAG,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,eAAe,IAAI,GAAG,CAAC,CAAC,CAAC,aAAa;AAC5E,MAAM,QAAQ,GAAG,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,aAAa,IAAI,MAAM,CAAC,CAAC,CAAE,gBAAgB;AAE/E,MAAM,OAAO,eAAe;IAC1B,KAAK,CAAC,QAAQ,CAAC,OAAe,EAAE,IAA+B;QAC7D,KAAK,EAAE,CAAC;QAER,mEAAmE;QACnE,IAAI,KAAK,IAAI,UAAU,EAAE,CAAC;YACxB,OAAO,CAAC,GAAG,CAAC,4BAA4B,QAAQ,YAAY,KAAK,IAAI,UAAU,GAAG,CAAC,CAAC;YACpF,MAAM,KAAK,CAAC,QAAQ,EAAE,IAAI,EAAE,MAAM,CAAC,CAAC;QACtC,CAAC;QAED,OAAO,IAAI,CAAC,SAAS,CACnB;YACE,SAAS,EAAE;gBACT;oBACE,EAAE,EAAE,QAAQ;oBACZ,KAAK,EAAE,4DAA4D;oBACnE,KAAK,EAAE,CAAC,gBAAgB,EAAE,yBAAyB,EAAE,4BAA4B,CAAC;oBAClF,QAAQ,EAAE,0DAA0D;oBACpE,IAAI,EAAE,CAAC,UAAU,EAAE,SAAS,EAAE,SAAS,CAAC;oBACxC,IAAI,EAAE,MAAM;oBACZ,oBAAoB,EAAE,UAAU;iBACjC;gBACD;oBACE,EAAE,EAAE,QAAQ;oBACZ,KAAK,EAAE,oDAAoD;oBAC3D,KAAK,EAAE,CAAC,gBAAgB,EAAE,yBAAyB,EAAE,yBAAyB,CAAC;oBAC/E,QAAQ,EAAE,iEAAiE;oBAC3E,IAAI,EAAE,CAAC,UAAU,EAAE,SAAS,EAAE,OAAO,CAAC;oBACtC,IAAI,EAAE,MAAM;oBACZ,oBAAoB,EAAE,UAAU;iBACjC;gBACD;oBACE,EAAE,EAAE,QAAQ;oBACZ,KAAK,EAAE,qDAAqD;oBAC5D,KAAK,EAAE,CAAC,gBAAgB,EAAE,4BAA4B,EAAE,2BAA2B,CAAC;oBACpF,QAAQ,EAAE,qEAAqE;oBAC/E,IAAI,EAAE,CAAC,eAAe,EAAE,MAAM,EAAE,eAAe,CAAC;oBAChD,IAAI,EAAE,QAAQ;oBACd,oBAAoB,EAAE,UAAU;iBACjC;aACF;SACF,EACD,IAAI,EACJ,CAAC,CACF,CAAC;IACJ,CAAC;CACF","sourcesContent":["import { ModelClient } from \"./ModelClient.js\";\n\nfunction sleep(ms: number, signal?: AbortSignal) {\n  return new Promise<void>((resolve, reject) => {\n    const id = setTimeout(resolve, ms);\n\n    if (!signal) return;\n\n    if (signal.aborted) {\n      clearTimeout(id);\n      return reject(signal.reason ?? new Error(\"Aborted\"));\n    }\n\n    signal.addEventListener(\n      \"abort\",\n      () => {\n        clearTimeout(id);\n        reject(signal.reason ?? new Error(\"Aborted\"));\n      },\n      { once: true }\n    );\n  });\n}\n\nlet calls = 0;\n\n/**\n * MOCK modes (via env):\n * - MOCK_FAIL_FIRST=1        â†’ solo retry (1Âª call lenta)\n * - MOCK_FAIL_FIRST=3        â†’ forza fallback se primary ha maxAttempts=3\n * - MOCK_DELAY_MS=2000       â†’ durata \"lentezza\" (deve superare timeoutMs)\n */\nconst FAIL_FIRST = Number(process.env.MOCK_FAIL_FIRST ?? \"1\"); // default: 1\nconst DELAY_MS = Number(process.env.MOCK_DELAY_MS ?? \"2000\");  // default: 2000\n\nexport class MockModelClient implements ModelClient {\n  async complete(_prompt: string, opts?: { signal?: AbortSignal }): Promise<string> {\n    calls++;\n\n    // fallisce (via lentezza/timeout) per le prime FAIL_FIRST chiamate\n    if (calls <= FAIL_FIRST) {\n      console.log(`ðŸ”¥ MOCK: simulo lentezza ${DELAY_MS}ms (call ${calls}/${FAIL_FIRST})`);\n      await sleep(DELAY_MS, opts?.signal);\n    }\n\n    return JSON.stringify(\n      {\n        testCases: [\n          {\n            id: \"TC-001\",\n            title: \"Mostra messaggio di retry quando il provider va in timeout\",\n            steps: [\"Avvia checkout\", \"Simula timeout provider\", \"Osserva UI messaggio retry\"],\n            expected: \"Compare un messaggio che invita a riprovare il pagamento\",\n            tags: [\"checkout\", \"payment\", \"timeout\"],\n            risk: \"high\",\n            createdFromFeatureId: \"FEAT-001\",\n          },\n          {\n            id: \"TC-002\",\n            title: \"Non creare ordine se il pagamento non Ã¨ confermato\",\n            steps: [\"Avvia checkout\", \"Simula timeout provider\", \"Verifica assenza ordine\"],\n            expected: \"Nessun ordine viene creato finchÃ© non arriva conferma pagamento\",\n            tags: [\"checkout\", \"payment\", \"order\"],\n            risk: \"high\",\n            createdFromFeatureId: \"FEAT-001\",\n          },\n          {\n            id: \"TC-003\",\n            title: \"Loggare correlationId per la richiesta di pagamento\",\n            steps: [\"Avvia checkout\", \"Esegui richiesta pagamento\", \"Controlla log applicativo\"],\n            expected: \"Nei log Ã¨ presente correlationId legato alla richiesta di pagamento\",\n            tags: [\"observability\", \"logs\", \"correlationId\"],\n            risk: \"medium\",\n            createdFromFeatureId: \"FEAT-001\",\n          },\n        ],\n      },\n      null,\n      2\n    );\n  }\n}\n"]}