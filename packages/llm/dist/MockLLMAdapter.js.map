{"version":3,"file":"MockLLMAdapter.js","sourceRoot":"","sources":["../src/MockLLMAdapter.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,CAAC,EAAE,MAAM,KAAK,CAAC;AACxB,OAAO,EAAe,cAAc,EAAE,MAAM,aAAa,CAAC;AAE1D,OAAO,EAAE,YAAY,EAAE,MAAM,0BAA0B,CAAC;AACxD,OAAO,EAAE,eAAe,EAAE,MAAM,4BAA4B,CAAC;AAC7D,OAAO,EAAE,YAAY,EAAE,MAAM,oCAAoC,CAAC;AAClE,OAAO,EAAE,cAAc,EAAE,MAAM,sCAAsC,CAAC;AAEtE,MAAM,iBAAiB,GAAG,CAAC,CAAC,MAAM,CAAC;IACjC,SAAS,EAAE,CAAC,CAAC,KAAK,CAAC,cAAc,CAAC;CACnC,CAAC,CAAC;AAEH,MAAM,OAAO,cAAc;IACjB,YAAY,GAAG,IAAI,YAAY,EAAE,CAAC;IAClC,KAAK,GAAG,IAAI,eAAe,EAAE,CAAC;IAEtC,KAAK,CAAC,iBAAiB,CAAC,IAAiB;QACvC,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,WAAW,CAChD,EAAE,IAAI,EAAE,oBAAoB,EAAE,OAAO,EAAE,IAAI,EAAE,EAC7C,IAAI,CACL,CAAC;QAEF,aAAa;QACb,MAAM,WAAW,GAAG,GAAG,EAAE,CACvB,cAAc,CACZ,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,EAAE,EAAE,MAAM,EAAE,CAAC,EACvD;YACE,SAAS,EAAE,IAAI;YACf,WAAW,EAAE,CAAC;YACd,WAAW,EAAE,GAAG;YAChB,UAAU,EAAE,IAAI;YAChB,SAAS,EAAE,CAAC,EAAE,OAAO,EAAE,EAAE,EAAE,CACzB,OAAO,CAAC,GAAG,CAAC,wBAAwB,OAAO,EAAE,CAAC;YAChD,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE,OAAO,EAAE,QAAQ,EAAE,GAAG,EAAE,EAAE,EAAE,CAC/C,OAAO,CAAC,GAAG,CACT,oCAAoC,OAAO,UAAU,OAAO,WAAW,QAAQ,CAAC,MAAM,QAAS,GAAW,EAAE,IAAI,EAAE,CACnH;SACJ,CACF,CAAC;QAEJ,eAAe;QACf,MAAM,aAAa,GAAG,GAAG,EAAE,CACzB,cAAc,CACZ,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,MAAM,EAAE,EAAE,MAAM,EAAE,CAAC,EACvD;YACE,SAAS,EAAE,IAAI;YACf,WAAW,EAAE,CAAC;YACd,WAAW,EAAE,GAAG;YAChB,UAAU,EAAE,IAAI;YAChB,SAAS,EAAE,CAAC,EAAE,OAAO,EAAE,EAAE,EAAE,CACzB,OAAO,CAAC,GAAG,CAAC,0BAA0B,OAAO,EAAE,CAAC;SACnD,CACF,CAAC;QAEJ,MAAM,GAAG,GAAG,MAAM,YAAY,CAAC,WAAW,EAAE,aAAa,EAAE;YACzD,WAAW,EAAE,cAAc;YAC3B,aAAa,EAAE,gBAAgB;YAC/B,UAAU,EAAE,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE,GAAG,EAAE,EAAE,EAAE,CAChC,OAAO,CAAC,GAAG,CACT,sBAAsB,IAAI,OAAO,EAAE,QAAS,GAAW,EAAE,IAAI,EAAE,CAChE;SACJ,CAAC,CAAC;QAEH,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QAC/B,MAAM,SAAS,GAAG,iBAAiB,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QAElD,OAAO,SAAS,CAAC,SAAS,CAAC;IAC7B,CAAC;CACF","sourcesContent":["import { z } from \"zod\";\nimport { FeatureSpec, TestCaseSchema } from \"@llmqa/core\";\nimport { LLMAdapter } from \"./LLMAdapter.js\";\nimport { PromptEngine } from \"./prompt/PromptEngine.js\";\nimport { MockModelClient } from \"./model/MockModelClient.js\";\nimport { withFallback } from \"./infra/resilience/withFallback.js\";\nimport { withResilience } from \"./infra/resilience/withResilience.js\";\n\nconst ModelOutputSchema = z.object({\n  testCases: z.array(TestCaseSchema),\n});\n\nexport class MockLLMAdapter implements LLMAdapter {\n  private promptEngine = new PromptEngine();\n  private model = new MockModelClient();\n\n  async generateTestCases(spec: FeatureSpec) {\n    const prompt = await this.promptEngine.buildPrompt(\n      { name: \"generate_testcases\", version: \"v1\" },\n      spec\n    );\n\n    // 游리 PRIMARY\n    const primaryCall = () =>\n      withResilience(\n        ({ signal }) => this.model.complete(prompt, { signal }),\n        {\n          timeoutMs: 1000,\n          maxAttempts: 3,\n          baseDelayMs: 250,\n          maxDelayMs: 4000,\n          onAttempt: ({ attempt }) =>\n            console.log(`游리 [primary] attempt=${attempt}`),\n          onRetry: ({ attempt, delayMs, decision, err }) =>\n            console.log(\n              `游대 [primary] retry after attempt=${attempt} delay=${delayMs} reason=${decision.reason} err=${(err as any)?.name}`\n            ),\n        }\n      );\n\n    // 游릭 SECONDARY\n    const secondaryCall = () =>\n      withResilience(\n        ({ signal }) => this.model.complete(prompt, { signal }),\n        {\n          timeoutMs: 1500,\n          maxAttempts: 1,\n          baseDelayMs: 250,\n          maxDelayMs: 4000,\n          onAttempt: ({ attempt }) =>\n            console.log(`游릭 [secondary] attempt=${attempt}`),\n        }\n      );\n\n    const raw = await withFallback(primaryCall, secondaryCall, {\n      primaryName: \"mock-primary\",\n      secondaryName: \"mock-secondary\",\n      onFallback: ({ from, to, err }) =>\n        console.log(\n          `游 [fallback] from=${from} to=${to} err=${(err as any)?.name}`\n        ),\n    });\n\n    const parsed = JSON.parse(raw);\n    const validated = ModelOutputSchema.parse(parsed);\n\n    return validated.testCases;\n  }\n}\n"]}